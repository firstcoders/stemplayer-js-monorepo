<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        background-color: #333;
      }
    </style>
  </head>
  <body>
    <div id="demo"></div>

    <script type="module">
      import { html, render } from 'lit';
      import * as Tone from "tone";
      import '../stemplayer.js';

      const audioCtx = new AudioContext();

      Tone.setContext(audioCtx);

      // Create a Tone.js gain node as the entry point (this has proper Web Audio API input)
      const toneInput = new Tone.Gain(1);

      // Create Tone.js filter and pitch shift
      const filter = new Tone.Filter({
        frequency: 90000,
        type: "lowpass"
      });

      const pitchShift = new Tone.PitchShift({
        pitch: -2 // Transpose down 7 semitones (a perfect fifth)
      });

      // Connect Tone.js nodes: toneInput -> filter -> pitchShift -> destination
      toneInput.connect(filter);
      filter.connect(pitchShift);
      pitchShift.toDestination();


      render(
        html`
        <stemplayer-js .audioContext=${audioCtx} .destination=${toneInput.input}>
          <stemplayer-js-controls
            slot="header"
            label="Demo track"
          ></stemplayer-js-controls>
          <stemplayer-js-stem
            label="Drums A"
            src="assets/audio/106%20DRUMS%20A_02.5.m3u8"
            waveform="assets/waveforms/106%20DRUMS%20A_02.5.json"
            volume="1"
          >
          </stemplayer-js-stem>
          <stemplayer-js-stem
            id="stem-drums-b"
            label="Drums B"
            src="assets/audio/106%20DRUMS%20B_01.5.m3u8"
            waveform="assets/waveforms/106%20DRUMS%20B_01.5.json"
            muted="true"
            volume="0.8"
          ></stemplayer-js-stem>
          <stemplayer-js-stem
            label="Conga"
            src="assets/audio/106%20CONGA_03.3.m3u8"
            waveform="assets/waveforms/106%20CONGA_03.3.json"
            volume="0.7"
          ></stemplayer-js-stem>
          <stemplayer-js-stem
            label="Casaba"
            src="assets/audio/106%20CABASA_04.3.m3u8"
            waveform="assets/waveforms/106%20CABASA_04.3.json"
            volume="0.4"
            muted="true"
          ></stemplayer-js-stem>
          <stemplayer-js-stem
            label="Bell"
            src="assets/audio/106%20BELL_05.3.m3u8"
            waveform="assets/waveforms/106%20BELL_05.3.json"
            bg-color="green"
            volume="0.5"
          ></stemplayer-js-stem>
        </stemplayer-js>
        `,
        document.querySelector('#demo')
      );
    </script>



  </body>
</html>
